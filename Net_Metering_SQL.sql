--Table NET_METERING:-  
--BD :--- CRM.REV_METER_READINGS_NET_METERS_MASTER
--SOLAR :- CRM.REV_METER_READINGS_NET_METERS_MASTER_SSPVS

--RAW DATA :- CRM.REV_RAW_READINGS_NET_METERS_MASTER
--RAW DATA :- CRM.REV_RAW_READINGS_NET_METERS_MASTER_SSPVS

--==============================================================
--STORE PROCEDURE NETMETERING :- 
--SP for Search Button:- [CRM].[REV_SPR_GET_NETMETERING_CUNSUMERS]

--Sp for Maximum Allowed Generation Per Kw Per Day Dropdown:- [CRM].[GET_MAXIMUM_ALLOWED_GENERATION_KW_PER_DAY]

--Sp for Vector Type Dropdown:-  [CRM].[ADMIN_SPR_GET_VECTOR_TYPE] 

--Sp for METER STATUS Dropdown:- [CRM].[REV_SPR_MST_METER_STATUS]

--Sp for Add Row Table Data:- [CRM].[SPC_NetMetering_Consumers] 

--Sp for Get,Delete,Update Grid Data:- SPU_NetMetering_Consumers 
--sp_helptext 'crm.REV_SPM_DIRECT_ORDER_NET_METER_SSPVS'
--******************************************************************
--SELECT QUERY :-- 
--********************************************************************
SELECT * FROM CRM.CONSUMER_METER_INFO WHERE K_NO = 210118037290
SELECT SERVICE_STATUS_CODE ,* FROM crm.CONSUMERS WHERE K_NO= 210118037260

select * from [CRM].[REV_METER_READINGS_NET_METERS_MASTER] where K_NO =210118037292

--UPDATE CONSUMERS SET BINDER_ID= 11516 WHERE K_NO = 210118018738


select * from [CRM].[REV_METER_READINGS_NET_METERS_MASTER] where k_no =210118037289
--UPDATE [CRM].[REV_METER_READINGS_NET_METERS_MASTER] SET BINDER_NO = 3008 WHERE K_NO = 210118037289

select * from [CRM].[REV_METER_READINGS_NET_METERS_MASTER_SSPVS] where k_no =210118037292
DELETE FROM REV_METER_READINGS_NET_METERS_MASTER_SSPVS WHERE SSPVS_ID IN (3224,3225,3227)
UPDATE [CRM].[REV_METER_READINGS_NET_METERS_MASTER_SSPVS] SET SSPVS_BILL_YEAR = 2023 where k_no =210118037289
--210118037254
SELECT * FROM CRM.REV_METER_READINGS WHERE K_NO = 210118036910

SELECT R.ROLE_NAME,U.LOGIN_NAME FROM CRM.MST_ROLES R JOIN CRM.MST_USERS U 
ON R.ROLE_ID =  U.INITIAL_ROLE_ID WHERE OFFICE_ID = 2101180

SELECT * FROM REV_BINDERS WHERE BINDER_NO = 2006

--36882
select * from [CRM].[REV_RAW_READINGS_NET_METERS_MASTER]	
select * from [CRM].[REV_RAW_READINGS_NET_METERS_MASTER_SSPVS]

--update CONSUMERS set BINDER_ID = 29143 where K_NO = 210118037289
select * from REV_BINDERS where BINDER_NO = 2006

SELECT * FROM REV_BINDER_SCHEDULING WHERE BINDER_NO = 3008

SELECT * FROM CRM.ERROR_LOGGER ORDER BY TIME_STAMP DESC


--Billing Table : -
--SELECT * FROM  BILL_METER_MASTER WHERE  KNO = 210118037116
-- SELECT * FROM BILL_NET_METERING_METER_MASTER WHERE KNO = 210118037116

--SELECT * FROM BILLING.WEB_SERVICE_LOGGER ORDER BY TIME_STAMP DESC 

SELECT C.IS_NET_METER,C.SERVICE_STATUS_CODE, C.K_NO,CR.TARIFF_CODE,RB.BILL_FORMAT_TYPE FROM CRM.CONSUMER_COMMERCIAL_INFO CR  (NOLOCK)
INNER JOIN CRM.CONSUMERS C(NOLOCK) ON CR.K_NO= C.K_NO INNER JOIN CRM.REV_BINDERS RB(NOLOCK) ON C.BINDER_ID =RB.BINDER_ID 
WHERE C.OFFICE_ID like '2101180%' and c.SERVICE_STATUS_CODE='R' and rb.BILL_FORMAT_TYPE = 'D' AND C.IS_NET_METER = 1 AND C.K_NO = 210118036937

select * from CONSUMERS where K_NO = 210118033342
--- 29323
--update CONSUMERS set SERVICE_STATUS_CODE = 'R' where K_NO =  210118036961
--update CONSUMERS set IS_NET_METER = 1 where K_NO = 210118033342
select binder_id,* from REV_BINDERS where BINDER_ID = 12700
--1892
--3008

select * from MST_BINDER_GROUP_TYPES

SELECT R.ROLE_ID,ROLE_NAME,U.LOGIN_NAME FROM CRM.MST_ROLES R JOIN CRM.MST_USERS U 
ON R.ROLE_ID =  U.INITIAL_ROLE_ID WHERE OFFICE_ID = 2101180 ORDER BY ROLE_ID 

SELECT * FROM MST_SERVICE_STATUS

select * from crm.REV_METER_READINGS where K_NO =  210118036910

SELECT COUNT(BINDER_ID),BINDER_ID FROM CONSUMERS WHERE K_NO LIKE '%2101180%' GROUP BY BINDER_ID HAVING COUNT(BINDER_ID) > 2

SELECT name, create_date, modify_date FROM sys.objects WHERE type = 'P' ORDER BY modify_date DESC

SELECT name, create_date, modify_date FROM sys.tables ORDER BY modify_date DESC

select COUNT(K_NO),K_NO from crm.CONSUMER_METER_INFO where k_no like '2101180%' group by K_NO having COUNT(K_NO) > 2

Select * from [CRM].[CONSUMER_NET_METERING_INFO_BD] WHERE  K_NO=210118036910 ORDER BY TIME_STAMP DESC
SELECT * from [CRM].[CONSUMER_NET_METERING_INFO_SSPVS] WHERE K_NO = 210118036910 ORDER BY TIME_STAMP DESC

SELECT * FROM CRM.ERROR_LOGGER ORDER BY TIME_STAMP DESC

select * from crm.MST_USERS where OFFICE_ID = 2101180

SELECT TOP 5 READING_ID,SSPVS_READING_ID ,* FROM ADV_CONSUMER_METER_INFO_NET_METERING_SSPVS  where K_NO = 210118036910

SELECT * FROM CRM.ADV_CONSUMER_METER_INFO_NET_METERING_SSPVS WHERE K_NO = 210118018640
SELECT * FROM CRM.ADV_CONSUMER_METER_INFO_NET

SELECT * FROM ADV_ORDER_BASE ORDER BY TIME_STAMP DESC --WHERE BINDER_NO = 3087
select SSPVS_CURRENT_READING_DATE,* from [CRM].[REV_METER_READINGS_NET_METERS_MASTER_SSPVS] where K_NO = 210118036910

--DELETE FROM ADV_CONSUMER_METER_INFO_NET_METERING_SSPVS  where K_NO = 210118036910
--DELETE FROM CRM.ADV_ORDER_BASE WHERE K_NO = 210118036910

--********************************************************************
--UPDATE QUERY :- 
--********************************************************************
--UPDATE CRM.CONSUMERS SET IS_NET_METER  = NULL WHERE K_NO IN (210118037253)
--UPDATE  [CRM].[REV_METER_READINGS_NET_METERS_MASTER_SSPVS] SET SSPVS_TOD_OOFPEAK_CURRENT_KWH = 123 WHERE K_NO = 210118036937
--UPDATE CRM.CONSUMERS SET SERVICE_STATUS_CODE = 'N' WHERE K_NO = 210118037264
--UPDATE [CRM].[REV_METER_READINGS_NET_METERS_MASTER_SSPVS] 
--SET SSPVS_CURRENT_READING_DATE = '2023-09-27 00:00:00.000' WHERE K_NO = 210118026144
--UPDATE CRM.CONSUMERS SET IS_NET_METER = Null WHERE K_NO = 210118037228
--********************************************************************
--DELETE QUERY:- 
--********************************************************************
--DELETE FROM [CRM].[REV_METER_READINGS_NET_METERS_MASTER_SSPVS]  WHERE K_NO = 210118037290
--DELETE FROM [CRM].[REV_METER_READINGS_NET_METERS_MASTER]   WHERE K_NO = 210118037290
--210118037156
--=====================================================================
SELECT * FROM CRM.MST_USERS WHERE OFFICE_ID = '2101180' AND IS_ACTIVE =1

SELECT * FROM CRM.MST_ACTIVITIES WHERE ACTIVITY_CAPTION LIKE '%MCO%'

--  select * from crm.MM_ITEM_METER_TECHNICAL_DETAIL ======
--========================
--MCO :- 
select * FROM [CRM].[ORDER_COMPLIANCE_METER_INFO] where K_NO = 210118036692
								
SELECT name FROM   sys.procedures WHERE  OBJECT_DEFINITION(OBJECT_ID) LIKE '%REV_RAW_READING_REVISION_NET_METERS_SSPVS%'

select * from sys.procedures where name like '%REV_RAW_READING_REVISION_NET_METERS_ADDED_SSPVS%'

--select * from INFORMATION_SCHEMA.ROUTINES where ROUTINE_TYPE = 'REV_IS_NET_METER_ADVICE_PUNCHABLE'

--update REV_DC_WARNING_DETAILS set WARNING_DAYS=0 where k_no=210118033787	

select * from REQUEST where REQUEST_ID = 210118016373

select * from crm.MST_PROCESSES

select * from CRM.MST_ACTIVITIES where URL= '../SM10/SM10_TRNS/DCOCompliance.aspx'

SELECT * FROM CRM.REV_BINDERS WHERE BINDER_NO = 2007
SELECT * FROM CRM.REV_BINDERS WHERE BINDER_NO = 2006

--UPDATE REV_BINDERS SET Bill_Month = 9 WHERE BINDER_ID = 29527

SELECT * FROM REV_BINDERS WHERE BINDER_NO = 3008

--UPDATE REV_BINDERS SET BILLING_CYCLE_CODE = 1 WHERE BINDER_ID = 29143 

SELECT  BD_METER_STATUS_CODE, * FROM REV_METER_READINGS_NET_METERS_MASTER WHERE K_NO = 210118018640
SELECT * FROM REV_METER_READINGS_NET_METERS_MASTER WHERE K_NO = 210118018636
SELECT * FROM REV_METER_READINGS_NET_METERS_MASTER WHERE K_NO = 210118018631

SELECT * FROM CONSUMERS WHERE K_NO LIKE '2101180186%'



DELETE FROM REV_METER_READINGS_NET_METERS_MASTER_SSPVS WHERE K_NO  = 210118018637
DELETE FROM REV_METER_READINGS_NET_METERS_MASTER WHERE K_NO  = 210118018637

UPDATE CONSUMERS SET IS_NET_METER = NULL WHERE K_NO   IN (210118018631,210118018636,210118018633)
UPDATE CONSUMERS SET SERVICE_STATUS_CODE = 'R' WHERE K_NO = 210118018635

SELECT * FROM CONSUMERS WHERE K_NO = 210118022718

SELECT * FROM CONSUMERS WHERE K_NO = 210118018631
SELECT IS_Active,* FROM CONSUMER_METER_INFO WHERE K_NO = 210118018637
SELECT * FROM REV_RAW_READING_REVISION_NET_METERS_SSPVS
11502

SELECT SERVICE_STATUS_CODE, * from CONSUMERS WHERE OFFICE_ID  = 2101180 AND K_NO = 210118018636

--210118018631
--210118018632
--210118018633


11503
29175
11507

29533

SELECT BINDER_ID, * FROM REV_BINDERS WHERE BINDER_ID = 29175

SELECT * FROM CONSUMERS WHERE K_NO = 210118018631
SELECT * FROM CONSUMERS WHERE K_NO = 210118018636
SELECT * FROM CONSUMERS WHERE K_NO = 210118018633

SELECT TARIFF_CODE,* FROM CONSUMER_COMMERCIAL_INFO WHERE K_NO = 210118022718

UPDATE CONSUMER_COMMERCIAL_INFO SET TARIFF_CODE = '8000' WHERE K_NO = 210118022718

UPDATE CONSUMERS SET SCO_DATE = '2023-11-01 00:00:00.000' WHERE K_NO   IN (210118018631,210118018635,210118018633)

UPDATE CONSUMERS SET SERVICE_STATUS_CODE='R' WHERE K_NO  = 210118018635

SELECT TOKEN_NO, CURRENT_READING_DATE ,* FROM REV_METER_READINGS WHERE K_NO = 210118018637 AND TOKEN_NO IS NOT NULL

select TOP 1 CURRENT_READING_DATE,READING_ID FROM CRM.REV_METER_READINGS a inner join
     crm.CONSUMERS b on a.K_NO=b.K_NO WHERE b.K_NO=210118018637 
    AND TOKEN_NO IS NOT NULL AND b.SERVICE_STATUS_CODE IN('R','F','D') 
    ORDER BY a.TOKEN_NO DESC

UPDATE REV_METER_READINGS SET BILL_MONTH = 11 , BILL_YEAR = 2023,CURRENT_READING_DATE='2023-11-01 00:00:00.000' WHERE READING_ID = 2101180502829


select TOP 1 ISNULL(BILL_YEAR,0) FROM CRM.REV_METER_R	EADINGS a inner join
 crm.CONSUMERS b on a.K_NO=b.K_NO WHERE b.K_NO=210118018637 
    AND TOKEN_NO IS NOT NULL AND b.SERVICE_STATUS_CODE IN('R','F','D') 
    ORDER BY a.TOKEN_NO DESC
    
    SELECT SERVICE_STATUS_CODE,* FROM CONSUMERS WHERE K_NO= 210118022718
    UPDATE CONSUMERS SET BINDER_ID = 11502 WHERE K_NO =	
    
    select * from REV_BINDERS where BINDER_NO = 3086
    
    SELECT * FROM CONSUMERS WHERE BINDER_ID = 29533
    
 --   UPDATE CONSUMERS SET BINDER_ID =29533 WHERE K_NO = 210118018636
    
    